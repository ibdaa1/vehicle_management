<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>إدارة المستخدمين</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --brand-accent:#1f6f2b;
      --brand-accent-2:#2e7a2f;
      --card-bg:#ffffff;
      --muted:#6b7280;
      --text:#0d2b16;
      --border:#e6e9eb;
      --btn-ghost-bg:#ffffff;
      --btn-ghost-border:var(--border);
      font-family:"Tajawal",system-ui,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    body{font-family:"Tajawal",sans-serif;margin:18px;background:#f3f5f7;color:var(--text)}
    .card{background:var(--card-bg);padding:16px;border-radius:10px;border:1px solid var(--border);box-shadow:0 1px 2px rgba(15,23,42,0.03)}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{height:56px;border-radius:10px;background:linear-gradient(135deg,var(--brand-accent),var(--brand-accent-2));display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-weight:700;padding:8px 12px}
    .logo .line1{font-size:14px;letter-spacing:0.6px}
    .logo .line2{font-size:12px;opacity:0.95}
    h2{margin:0;font-size:1.1rem}
    .muted{color:var(--muted);font-size:0.95rem}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:10px;border:0;background:var(--brand-accent);color:#fff;cursor:pointer;font-weight:600}
    .btn.ghost{background:var(--btn-ghost-bg);color:var(--text);border:1px solid var(--btn-ghost-border)}
    .icon-btn{display:inline-flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:#fff;border:1px solid var(--border);color:var(--brand-accent);cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px;background:#fff}
    th,td{padding:10px;border-bottom:1px solid #f0f2f4;text-align:right}
    th{background:#fafafa;font-weight:600}
    td.actions{white-space:nowrap}
    .actions button{margin-left:6px;padding:8px;border-radius:8px;border:0;cursor:pointer;width:40px;height:36px;display:inline-flex;align-items:center;justify-content:center}
    .actions .edit{background:#2563eb;color:#fff} /* blue */
    .actions .del{background:#ef4444;color:#fff} /* red */
    .actions .toggle{background:#10b981;color:#fff} /* green */
    .actions .roles{background:#6b7280;color:#fff} /* gray */
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal{background:var(--card-bg);border-radius:10px;padding:18px;max-width:920px;width:96%;max-height:90vh;overflow:auto;border:1px solid var(--border)}
    .modal h3{margin-top:0}
    .form-row{display:flex;gap:12px;margin-bottom:10px;align-items:center}
    .form-row label{min-width:160px;font-weight:600}
    .form-row input[type="text"], .form-row input[type="email"], .form-row select, .form-row input[type="number"]{flex:1;padding:8px;border:1px solid var(--border);border-radius:6px}
    .modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .small{font-size:0.9rem;color:var(--muted)}
    @media(max-width:720px){ .form-row{flex-direction:column;align-items:stretch} .form-row label{min-width:unset} }
  </style>
</head>
<body>
  <div class="card topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <div class="line1">HCS Department</div>
        <div class="line2">الإدارة</div>
      </div>
      <div>
        <h2>إدارة المستخدمين</h2>
        <div class="small">قسم الأدمن — إدارة المستخدمين وصلاحيات الأدوار</div>
      </div>
    </div>

    <div class="controls" role="toolbar" aria-label="admin-actions">
      <!-- show roles management icon (visible) -->
      <a class="icon-btn" title="صلاحيات الأدوار" href="admin_roles.html"><i class="fa fa-user-shield" style="color:var(--brand-accent)"></i> صلاحيات الأدوار</a>
      <!-- keep activations removed as requested -->
      <button id="refreshBtn" class="btn ghost" title="تحديث القائمة"><i class="fa fa-arrows-rotate"></i> تحديث</button>
      <a href="index.html" class="btn ghost" title="العودة"><i class="fa fa-arrow-left"></i> العودة</a>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="muted" id="desc">جاري التحميل…</div>
    <div id="usersWrap">
      <table id="usersTable" aria-live="polite" role="table">
        <thead>
          <tr><th>الاسم</th><th>الرمز الوظيفي</th><th>البريد</th><th>الهاتف</th><th>الدور</th><th>الإدارة</th><th>القسم</th><th>الوحدة</th><th>الحالة</th><th>إجراءات</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Modal backdrop -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <h3 id="modalTitle">تعديل المستخدم</h3>
      <div id="modalBody"></div>
      <div class="modal-actions">
        <button id="modalCancel" class="btn ghost">إلغاء</button>
        <button id="modalSave" class="btn">حفظ</button>
      </div>
    </div>
  </div>

<script src="session_check.js"></script>
<script src="/vehicle_management/public/admin_users.js"></script>
<script>
(async function(){
  const s = await sessionCheck();
  if (!s || !s.success) return location.href='login.html';
  const role = parseInt(s.user.role_id || 0, 10);
  if (![1,2].includes(role)) {
    document.body.innerHTML = '<div style="padding:20px">غير مصرح. هذه الصفحة مخصصة للمسؤولين فقط.</div>';
    return;
  }
  AdminUsers.init();
})();
</script>
</body>
</html>